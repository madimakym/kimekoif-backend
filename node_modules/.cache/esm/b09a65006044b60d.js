let Catalog,fs;_604‍.x([["create",()=>create],["findByUser",()=>findByUser],["remove",()=>remove],["image",()=>image]]);_604‍.w("../models/catalog-model",[["default",["Catalog"],function(v){Catalog=v}]]);_604‍.w("fs",[["default",["fs"],function(v){fs=v}]]);


       const create = async (req, res) => {
    try {
        let fields = req.fields;
        let files = req.files;
        let catalog = new Catalog({
            user: fields.user,
            service: fields.service,
            status: true
        });

        if (files.image) {
            catalog.image.data = fs.readFileSync(files.image.path);
            catalog.image.contentType = files.image.type;
        }

        await catalog.save()
        return res.status(200).json({
            success: true,
            message: "Catalogue ajouté",
        })
    } catch (err) {
        return res.status(500).json({
            success: false,
            message: err.message,
        });
    }
};

       const findByUser = async (req, res) => {
    try {
        const body = req.body
        const user = await Catalog.find({
            $or: [{ user: body.user }],
        }).sort({ createdAt: "desc" });

        return res.status(200).json(user);

    } catch (error) {
        return res.status(500).json({
            status: 500,
            message: "Aucun resultat"
        });
    }
};

       const remove = async (req, res) => {
    const { id } = req.body
    try {
        await Catalog.findByIdAndRemove(id);
        return res.status(200).json({
            status: 200,
            message: "Catalogue supprimé",
        });
    } catch (error) {
        return res.status(500).json({
            status: 500,
            message: error.message,
        });
    }
};


       const image = async (req, res) => {
    let catalog = await Catalog.findById(req.params.catalogId).exec();
    if (catalog && catalog.image && catalog.image.data !== null) {
        res.set('Content-Type', catalog.image.contentType);
        return res.send(catalog.image.data);
    }
}