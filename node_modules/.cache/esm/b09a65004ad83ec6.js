let Catalog;_4ad‍.x([["create",()=>create],["findByUser",()=>findByUser],["remove",()=>remove]]);_4ad‍.w("../models/catalog-model",[["default",["Catalog"],function(v){Catalog=v}]]);
const upload = require("../middlewares/upload");
var multer = require("multer");

       const create = async (req, res) => {
    try {
        upload(req, res, function (err) {
            const body = req.body
            let catalog = new Catalog({
                user: body.user,
                service: body.service,
                image: req.files[0].filename,
                status: true
            });
            catalog.save()
            if (err instanceof multer.MulterError) {
                return res.status(500).json(err);
            } else if (err) {
                return res.status(500).json(err);
            }
            return res.status(200).json({
                success: true,
                message: "Catalogue ajouté",
            })
        });
    } catch (error) {
        _4ad‍.g.console.log("error ===>", error);
    }
};


       const findByUser = async (req, res) => {
    try {
        const user = await Catalog.find({
            $or: [{
                user: req.body.user
            }],
        }).populate([{
            path: "service",
            populate: {
                path: "service",
                model: "Service",
            },
        }]);
        return res.json(user);
    } catch (error) {
        return res.status(500).json({
            status: 500,
            message: "Aucun resultat"
        });
    }
};

       const remove = async (req, res) => {
    const { id } = req.body
    try {
        await Catalog.findByIdAndRemove(id);
        return res.status(200).json({
            status: 200,
            message: "Catalogue supprimé",
        });
    } catch (error) {
        return res.status(500).json({
            status: 500,
            message: error.message,
        });
    }
};